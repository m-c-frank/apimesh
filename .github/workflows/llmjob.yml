name: Process Issue and Generate Solutions

on:
  issues:
    types: [opened, reopened]

jobs:
  generate-solutions:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Prepare Prompt
        run: |
          echo "PROMPT=Issue Title: $(jq -r .issue.title < $GITHUB_EVENT_PATH)\nIssue Description: $(jq -r .issue.body < $GITHUB_EVENT_PATH)\nProvide a clear and concise answer in Markdown format, suggesting three to four creative and orthogonal ways to implement or address this issue." >> $GITHUB_ENV

      - name: Call OpenAI API
        run: |
          RESPONSE=$(curl -s "https://api.openai.com/v1/chat/completions" \
            -H "Content-Type: application/json" \
            -H "Authorization: Bearer ${{ secrets.OPENAI_API_KEY }}" \
            -d '{
                "model": "gpt-3.5-turbo",
                "messages": [{"role": "user", "content": "$PROMPT"}],
                "temperature": 0.7
              }')
          echo "RESPONSE=$RESPONSE" >> $GITHUB_ENV

      - name: Log Response
        run: echo "$RESPONSE"

      - name: Create README
        run: |
          echo "${{ steps.openai-call.outputs.answer }}" > SOLUTIONS_README.md
          git config --global user.name 'GitHub Actions Bot'
          git config --global user.email 'actions@github.com'
          git add SOLUTIONS_README.md
          git commit -m 'Add generated solutions README'
          git push

